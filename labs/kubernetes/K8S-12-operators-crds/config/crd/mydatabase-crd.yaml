apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mydatabases.database.example.com
  annotations:
    controller-gen.kubebuilder.io/version: v0.13.0
spec:
  group: database.example.com
  names:
    kind: MyDatabase
    listKind: MyDatabaseList
    plural: mydatabases
    singular: mydatabase
    shortNames:
      - mydb
    categories:
      - all
      - database
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Engine
          type: string
          jsonPath: .spec.engine
        - name: Version
          type: string
          jsonPath: .spec.version
        - name: Storage
          type: string
          jsonPath: .spec.storageSize
        - name: Replicas
          type: integer
          jsonPath: .spec.replicas
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Endpoint
          type: string
          jsonPath: .status.endpoint
          priority: 1
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
      schema:
        openAPIV3Schema:
          type: object
          description: MyDatabase is the Schema for the mydatabases API
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              type: object
              required:
                - engine
                - version
                - storageSize
              properties:
                engine:
                  type: string
                  description: Database engine type
                  enum:
                    - postgres
                    - mysql
                    - redis
                version:
                  type: string
                  description: Database engine version
                storageSize:
                  type: string
                  description: Size of the persistent volume (e.g., "10Gi")
                  pattern: '^\d+Gi$'
                replicas:
                  type: integer
                  description: Number of database pod replicas
                  minimum: 1
                  maximum: 5
                  default: 1
                storageClass:
                  type: string
                  description: Kubernetes StorageClass name
                resources:
                  type: object
                  description: Resource requests and limits
                  properties:
                    cpuRequest:
                      type: string
                    cpuLimit:
                      type: string
                    memoryRequest:
                      type: string
                    memoryLimit:
                      type: string
                backupEnabled:
                  type: boolean
                  description: Enable automatic daily backups
                  default: false
            status:
              type: object
              properties:
                phase:
                  type: string
                  enum:
                    - Provisioning
                    - Running
                    - Failed
                    - Terminating
                readyReplicas:
                  type: integer
                storageProvisioned:
                  type: boolean
                endpoint:
                  type: string
                lastReconcileTime:
                  type: string
                  format: date-time
                conditions:
                  type: array
                  items:
                    type: object
                    required:
                      - type
                      - status
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                      reason:
                        type: string
                      message:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
