# Helm values for NGINX Ingress Controller
# helm install ingress-nginx ingress-nginx/ingress-nginx -f nginx-ingress-values.yaml

controller:
  # Number of Ingress Controller replicas for high availability
  replicaCount: 2

  # Resource limits for the controller pods
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 256Mi

  # Enable metrics for Prometheus scraping
  metrics:
    enabled: true
    port: 10254
    serviceMonitor:
      enabled: false       # Set to true if Prometheus Operator is installed

  # Default SSL certificate (fallback for requests without matching Ingress TLS)
  # extraArgs:
  #   default-ssl-certificate: "ingress-nginx/default-tls-secret"

  # NGINX configuration snippets
  config:
    # Security headers
    use-forwarded-headers: "true"
    compute-full-forwarded-for: "true"
    use-proxy-protocol: "false"

    # Logging
    log-format-upstream: '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" $request_length $request_time [$proxy_upstream_name] [$proxy_alternative_upstream_name] $upstream_addr $upstream_response_length $upstream_response_time $upstream_status $req_id'

    # Timeouts
    proxy-connect-timeout: "10"
    proxy-read-timeout: "60"
    proxy-send-timeout: "60"

    # Request size limit (for file uploads)
    proxy-body-size: "10m"

  # Pod anti-affinity to spread controller across nodes
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/component
                  operator: In
                  values:
                    - controller
            topologyKey: kubernetes.io/hostname

  # Service configuration
  service:
    type: LoadBalancer      # Use NodePort for Minikube: type: NodePort
    annotations: {}
    # AWS annotations example:
    # annotations:
    #   service.beta.kubernetes.io/aws-load-balancer-type: nlb
    #   service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"

# Default backend (responds to requests that don't match any Ingress rule)
defaultBackend:
  enabled: true
  replicaCount: 1
  resources:
    requests:
      cpu: 10m
      memory: 20Mi
    limits:
      cpu: 50m
      memory: 64Mi
